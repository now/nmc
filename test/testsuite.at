AT_INIT

# AT_TESTED([nmc])

AT_SETUP([Document only consisting of a title])

AT_DATA([title],
[[Title
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>]])

AT_CLEANUP

AT_SETUP([Document only consisting of a title with multiple words])

AT_DATA([title],
[[  Word1   Word2
]])

AT_NMC_CHECK([title],
[[  <title>Word1 Word2</title>]])

AT_CLEANUP

AT_SETUP([Document only consisting of a multi-line title])

AT_DATA([title],
[[  Word1
  Word2
]])

AT_NMC_CHECK([title],
[[  <title>Word1 Word2</title>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a paragraph])

AT_DATA([title],
[[Title

  Paragraph
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <p>Paragraph</p>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a multi-line paragraph])

AT_DATA([title],
[[Title

  Line1
  Line2
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <p>Line1 Line2</p>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by two paragraphs])

AT_DATA([title],
[[Title

  Paragraph1

  Paragraph2
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <p>Paragraph1</p>
  <p>Paragraph2</p>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a section containing a paragraph])

AT_DATA([title],
[[Title

§ Section

    Paragraph
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <section>
    <title>Section</title>
    <p>Paragraph</p>
  </section>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a section containing two paragraphs])

AT_DATA([title],
[[Title

§ Section

    Paragraph1

    Paragraph2
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <section>
    <title>Section</title>
    <p>Paragraph1</p>
    <p>Paragraph2</p>
  </section>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a section containing a multi-line paragraph])

AT_DATA([title],
[[Title

§ Section

    Line1
    Line2
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <section>
    <title>Section</title>
    <p>Line1 Line2</p>
  </section>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by two sections])

AT_DATA([title],
[[Title

§ Section1

    Paragraph1

§ Section2

    Paragraph2
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <section>
    <title>Section1</title>
    <p>Paragraph1</p>
  </section>
  <section>
    <title>Section2</title>
    <p>Paragraph2</p>
  </section>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a paragraph and a section])

AT_DATA([title],
[[Title

  Paragraph1

§ Section1

    Paragraph1

§ Section2

    Paragraph2
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <p>Paragraph1</p>
  <section>
    <title>Section1</title>
    <p>Paragraph1</p>
  </section>
  <section>
    <title>Section2</title>
    <p>Paragraph2</p>
  </section>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a paragraph, an itemization, and a paragraph])

AT_DATA([title],
[[Title

  Paragraph1

• Item1

  Paragraph2
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <p>Paragraph1</p>
  <itemization>
    <item>
      <p>Item1</p>
    </item>
  </itemization>
  <p>Paragraph2</p>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a two-item itemization])

AT_DATA([title],
[[Title

• Item1
• Item2
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <itemization>
    <item>
      <p>Item1</p>
    </item>
    <item>
      <p>Item2</p>
    </item>
  </itemization>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by an itemization with an inline])

AT_DATA([title],
[[Title

• A ‹Item1›
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <itemization>
    <item>
      <p>A <code>Item1</code></p>
    </item>
  </itemization>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a two-item itemization, the first containing two paragraphs])

AT_DATA([title],
[[Title

•   Line1
    Line2

    Paragraph2
•   Item2
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <itemization>
    <item>
      <p>Line1 Line2</p>
      <p>Paragraph2</p>
    </item>
    <item>
      <p>Item2</p>
    </item>
  </itemization>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a two-item enumeration])

AT_DATA([title],
[[Title

₁ Item1
₂ Item2
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <enumeration>
    <item>
      <p>Item1</p>
    </item>
    <item>
      <p>Item2</p>
    </item>
  </enumeration>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a three-item definition])

AT_DATA([title],
[[Title

/ A. /   1
/ B. /   2
/ C. /   3
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <definitions>
    <item>
      <term>A</term>
      <definition>
        <p>1</p>
      </definition>
    </item>
    <item>
      <term>B</term>
      <definition>
        <p>2</p>
      </definition>
    </item>
    <item>
      <term>C</term>
      <definition>
        <p>3</p>
      </definition>
    </item>
  </definitions>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a three-item definition with the first being unterminated])

AT_DATA([title],
[[Title

/ A.    1
/ B. /   2
/ C. /   3
]])

AT_NMC_CHECK_FAIL([title], [3:1: missing ending “. /” for term in definition])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a paragraph with footnotes])

AT_DATA([title],
[[Title

  Abbr¹⁺² for US³³

¹ Abbreviation for Abbreviation
² See the Wikipedia entry for “Abbreviation” at http://en.wikipedia.org/wiki/Abbreviation
³³ Abbreviation for United States
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <p><ref title="See the Wikipedia entry for “Abbreviation”" uri="http://en.wikipedia.org/wiki/Abbreviation"><abbreviation for="Abbreviation">Abbr</abbreviation></ref> for <abbreviation for="United States">US</abbreviation></p>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a section containing a paragraph with footnotes])

AT_DATA([title],
[[Title

§ Section

    Word1 Abbr¹ Word3

  ¹ Abbreviation for Abbreviation
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <section>
    <title>Section</title>
    <p>Word1 <abbreviation for="Abbreviation">Abbr</abbreviation> Word3</p>
  </section>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a section with footnotes])

AT_DATA([title],
[[Title

§ Section

    Word1 Abbr¹ Word3

¹ Abbreviation for Abbreviation
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <section>
    <title>Section</title>
    <p>Word1 <abbreviation for="Abbreviation">Abbr</abbreviation> Word3</p>
  </section>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by two sections with footnotes])

AT_DATA([title],
[[Title

§ Section

    Word1 Abbr¹ Word3

¹ Abbreviation for Abbreviation

§ Section

    Word1 Abbr¹ Word3

¹ Abbreviation for Abbreviation
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <section>
    <title>Section</title>
    <p>Word1 <abbreviation for="Abbreviation">Abbr</abbreviation> Word3</p>
  </section>
  <section>
    <title>Section</title>
    <p>Word1 <abbreviation for="Abbreviation">Abbr</abbreviation> Word3</p>
  </section>]])

AT_CLEANUP

AT_SETUP([Reused footnotes])

AT_DATA([title],
[[Title

§ Section

    Abbr¹

  § Sub-section

      Abbr¹

  ¹ Abbreviation for Abbreviation
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <section>
    <title>Section</title>
    <p><abbreviation for="Abbreviation">Abbr</abbreviation></p>
    <section>
      <title>Sub-section</title>
      <p><abbreviation for="Abbreviation">Abbr</abbreviation></p>
    </section>
  </section>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a paragraph with a long footnote])

AT_DATA([title],
[[Title

  Word1 Abbr¹ Word3

¹ Abbreviation for
  Abbreviation
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <p>Word1 <abbreviation for="Abbreviation">Abbr</abbreviation> Word3</p>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a paragraph with an unrecognized footnote])

AT_DATA([title],
[[Title

  Word1 Abbr¹ Word3

¹ Junk text in this here footnote
]])

AT_NMC_CHECK_FAIL([title], [5.1-34: unrecognized footnote content: Junk text in this here footnote])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a paragraph followed by two footnotes with same sigil])

AT_DATA([title],
[[Title

  Word1¹

¹ Abbreviation for Abbreviaton
¹ Abbreviation for Abbreviaton
]])

AT_NMC_CHECK_FAIL([title], [6.1-31: footnote ¹ already defined at 5.1-31])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a paragraph followed by two unreferenced footnotes])

AT_DATA([title],
[[Title

  Word1

¹ Abbreviation for Abbreviaton
² Abbreviation for Abbreviaton
]])

AT_NMC_CHECK_FAIL([title], [5.1-31: unreferenced footnote: ¹
6.1-31: unreferenced footnote: ²])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a code block])

AT_DATA([title],
[[Title

    Code
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <code>Code</code>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a multi-line code block])

AT_DATA([title],
[[Title

    Code1
    Code2
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <code>Code1
Code2</code>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by an indented multi-line code block])

AT_DATA([title],
[[Title

    Code1
      Code2
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <code>Code1
  Code2</code>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a multi-line code block with empty lines])

AT_DATA([title],
[[Title

    Code1
    Code2

    Code3
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <code>Code1
Code2

Code3</code>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a multi-line code block with multiple empty lines])

AT_DATA([title],
[[Title

    Code1
    Code2


    Code3
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <code>Code1
Code2


Code3</code>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a multi-line code block with empty lines followed by a paragraph])

AT_DATA([title],
[[Title

    Code1
    Code2

    Code3

  Paragraph
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <code>Code1
Code2

Code3</code>
  <p>Paragraph</p>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a paragraph containing a code inline])

AT_DATA([title],
[[Title

  Word1 ‹Code› Word2
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <p>Word1 <code>Code</code> Word2</p>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a paragraph containing a code inline containing code inline end characters])

AT_DATA([title],
[[Title

  Word1 ‹‹Code›› Word2
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <p>Word1 <code>‹Code›</code> Word2</p>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a paragraph containing a code inline that is immediately followed by text])

AT_DATA([title],
[[Title

  Word1 ‹Code›s Word2
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <p>Word1 <code>Code</code>s Word2</p>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a paragraph containing an unterminated code inline])

AT_DATA([title],
[[Title

  ‹Code
]])

AT_NMC_CHECK_FAIL([title], [3:3: missing ending ‘›’ for code inline])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a paragraph containing two unterminated code inlines])

AT_DATA([title],
[[Title

  ‹Code
  ‹Code
]])

AT_NMC_CHECK_FAIL([title],
[[3:3: missing ending ‘›’ for code inline
4:3: missing ending ‘›’ for code inline]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a paragraph containing an emphasis inline])

AT_DATA([title],
[[Title

  Word1 /Emphasis/ Word2
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <p>Word1 <emphasis>Emphasis</emphasis> Word2</p>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a paragraph containing an emphasis inline containing a solidus])

AT_DATA([title],
[[Title

  Word1 /True/False/ Word2
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <p>Word1 <emphasis>True/False</emphasis> Word2</p>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a paragraph containing an unterminated emphasis inline])

AT_DATA([title],
[[Title

  /Emphasis
]])

AT_NMC_CHECK_FAIL([title], [3:3: missing ending ‘/’ for emphasis inline])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a paragraph containing a group])

AT_DATA([title],
[[Title

  {Word1 /True/False/ Word2}
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <p>Word1 <emphasis>True/False</emphasis> Word2</p>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a quote])

AT_DATA([title],
[[Title

> To clique, or not to clique, that is the question:
> Whether ’tis nobler in the mind to suffer
> The slings and arrows of outrageous fortune,
> Or to take arms against a sea of troubles,
> And by opposing end them?
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <quote>
    <line>To clique, or not to clique, that is the question:</line>
    <line>Whether ’tis nobler in the mind to suffer</line>
    <line>The slings and arrows of outrageous fortune,</line>
    <line>Or to take arms against a sea of troubles,</line>
    <line>And by opposing end them?</line>
  </quote>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a one-line quote spanning two lines followed by an attribution])

AT_DATA([title],
[[Title

> Perfection (in design) is achieved not when there is nothing more to
  add, but rather when there is nothing more to take away.
— Antoine de Saint-Exupéry
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <quote>
    <line>Perfection (in design) is achieved not when there is nothing more to add, but rather when there is nothing more to take away.</line>
    <attribution>Antoine de Saint-Exupéry</attribution>
  </quote>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a table consisting of one row with one entry])

AT_DATA([title],
[[Title

| Entry |
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <table>
    <body>
      <row>
        <entry>Entry</entry>
      </row>
    </body>
  </table>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a table consisting of one row with two entries])

AT_DATA([title],
[[Title

| One | Two |
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <table>
    <body>
      <row>
        <entry>One</entry>
        <entry>Two</entry>
      </row>
    </body>
  </table>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a table consisting of two rows with two entries])

AT_DATA([title],
[[Title

| One   | Two  |
| Three | Four |
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <table>
    <body>
      <row>
        <entry>One</entry>
        <entry>Two</entry>
      </row>
      <row>
        <entry>Three</entry>
        <entry>Four</entry>
      </row>
    </body>
  </table>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a table consisting of a head row followed by a row with two entries])

AT_DATA([title],
[[Title

| One   | Two  |
|-------+------|
| Three | Four |
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <table>
    <head>
      <row>
        <entry>One</entry>
        <entry>Two</entry>
      </row>
    </head>
    <body>
      <row>
        <entry>Three</entry>
        <entry>Four</entry>
      </row>
    </body>
  </table>]])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a broken beginning of line])

AT_DATA([title],
[[Title

A a
]])

AT_NMC_CHECK_FAIL([title], [3:1: unrecognized character ‘A’ (U+0041) at beginning of line])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a broken quote])

AT_DATA([title],
[[Title

>A b
]])

AT_NMC_CHECK_FAIL([title], [3:1: missing ‘ ’ after ‘>’ at beginning of line])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a broken itemization])

AT_DATA([title],
[[Title

•A b
]])

AT_NMC_CHECK_FAIL([title], [3:1: missing ‘ ’ after ‘•’ at beginning of line])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a broken table])

AT_DATA([title],
[[Title

|A |
]])

AT_NMC_CHECK_FAIL([title], [3:1: missing ‘ ’ after ‘|’ at beginning of line])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a broken definition])

AT_DATA([title],
[[Title

/A. /   1
]])

AT_NMC_CHECK_FAIL([title], [3:1: missing ‘ ’ after ‘/’ at beginning of line])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a broken paragraph])

AT_DATA([title],
[[Title

 A b
]])

AT_NMC_CHECK_FAIL([title], [3:1: missing ‘ ’ after ‘ ’ at beginning of line])

AT_CLEANUP

AT_SETUP([Document consisting of a title followed by a paragraph with a broken footnote])

AT_DATA([title],
[[Title

  Abbr¹

¹Abbreviation for Abbreviation
]])

AT_NMC_CHECK_FAIL([title], [5:1: missing ‘ ’ after ‘¹’ at beginning of line])

AT_CLEANUP

AT_SETUP([Test indent rules: first block in section is non-paragraph])

AT_DATA([title],
[[Title

§ Section

  • List
]])

AT_NMC_CHECK([title],
[[  <title>Title</title>
  <section>
    <title>Section</title>
    <itemization>
      <item>
        <p>List</p>
      </item>
    </itemization>
  </section>]])

AT_CLEANUP

AT_SETUP([Test indent rules: first block in an item is a nested item])

AT_DATA([title],
[[T

•   1

  •   2
]])

AT_NMC_CHECK([title],
[[  <title>T</title>
  <itemization>
    <item>
      <p>1</p>
      <itemization>
        <item>
          <p>2</p>
        </item>
      </itemization>
    </item>
  </itemization>]])

AT_CLEANUP


AT_SETUP([Test indent rules: first block in an item is a tightly nested item])

AT_DATA([title],
[[T

•   1
  •   2
]])

AT_NMC_CHECK([title],
[[  <title>T</title>
  <itemization>
    <item>
      <p>1</p>
      <itemization>
        <item>
          <p>2</p>
        </item>
      </itemization>
    </item>
  </itemization>]])

AT_CLEANUP

AT_SETUP([Test indent rules: an item followed by a paragraph])

AT_DATA([title],
[[T

•   1

  2
]])

AT_NMC_CHECK([title],
[[  <title>T</title>
  <itemization>
    <item>
      <p>1</p>
    </item>
  </itemization>
  <p>2</p>]])

AT_CLEANUP

AT_SETUP([Test indent rules: an item containing two paragraphs followed by a paragraph])

AT_DATA([title],
[[T

•   1

    2

  3
]])

AT_NMC_CHECK([title],
[[  <title>T</title>
  <itemization>
    <item>
      <p>1</p>
      <p>2</p>
    </item>
  </itemization>
  <p>3</p>]])

AT_CLEANUP

AT_SETUP([Test indent rules: an item containing one paragraph spread on two lines])

AT_DATA([title],
[[T

•   1
    2
]])

AT_NMC_CHECK([title],
[[  <title>T</title>
  <itemization>
    <item>
      <p>1 2</p>
    </item>
  </itemization>]])

AT_CLEANUP

AT_SETUP([Test indent rules: an item containing one paragraph spread on two lines followed by a second paragraph])

AT_DATA([title],
[[T

•   1
    2

    3
]])

AT_NMC_CHECK([title],
[[  <title>T</title>
  <itemization>
    <item>
      <p>1 2</p>
      <p>3</p>
    </item>
  </itemization>]])

AT_CLEANUP

AT_SETUP([Test indent rules: an item containing one paragraph spread on two lines followed by a second paragraph and a paragraph])

AT_DATA([title],
[[T

•   1
    2

    3

  4
]])

AT_NMC_CHECK([title],
[[  <title>T</title>
  <itemization>
    <item>
      <p>1 2</p>
      <p>3</p>
    </item>
  </itemization>
  <p>4</p>]])

AT_CLEANUP

AT_SETUP([Test indent rules: an item containing two paragraphs followed by a paragraph beginning with a bol symbol])

AT_DATA([title],
[[T

•   1

    2

¶  —
]])

AT_NMC_CHECK([title],
[[  <title>T</title>
  <itemization>
    <item>
      <p>1</p>
      <p>2</p>
    </item>
  </itemization>
  <p>—</p>]])

AT_CLEANUP

